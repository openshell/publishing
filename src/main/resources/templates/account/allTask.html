<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <title>任务发布系统</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/css/main.css">
    <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
    <link rel="stylesheet" href="/webjars/bootstrap/3.3.7-1/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.css" type="text/css">
    <!-- 引入时间插件-->
    <link rel="stylesheet" type="text/css"
          href="/css/bootstrap-datetimepicker.css"
          media="all"/>

    <!-- 插件使用的样式表文件 -->
    <link rel="stylesheet" href="/css/selectpage.css" type="text/css">
</head>
<body class="app sidebar-mini rtl">

<header class="app-header">
    <a class="app-header__logo" href="/task/toAllTask"> <i
            class="fa fa-home"></i> 任务分发系统
    </a>
    <a class="app-sidebar__toggle" href="#" data-toggle="sidebar"
       aria-label="Hide Sidebar"></a>
    <ul class="app-nav">
        <a class="app-nav__item" href="/user/logout" >退出</a>
    </ul>
</header>

<div class="app-sidebar__overlay" data-toggle="sidebar"></div>

<aside class="app-sidebar">
    <div class="app-sidebar__user">
        <img class="app-sidebar__user-avatar"
             src="/img/admin.png" alt="User Image">
        <div>
            <p class="app-sidebar__user-name" th:text="${session.loginUser.userRealname}">

            </p>
            </p>

        </div>
    </div>
    <ul class="app-menu">
        <li><a class="app-menu__item"
               href="/task/toBackLog"><i
                class="app-menu__icon fa fa-dashboard"></i><span
                class="app-menu__label">待办任务</span></a>
        </li>
        <li><a class="app-menu__item active"
               href="/task/toAllTask"><i
                class="app-menu__icon fa fa-dashboard"></i><span
                class="app-menu__label">所有任务</span></a>
        </li>
        <li><a class="app-menu__item" href="/user/toAllUser"><i
                class="app-menu__icon fa fa-users"></i><span
                class="app-menu__label">人员列表</span></a>
        </li>
    </ul>
</aside>
<!-- 搭建显示页面 -->
<main class="app-content">
    <div class="title">
        <!--任务新建模态框-->
        <div class="modal fade" id="taskAddModal" tabindex="-1" role="dialog"
             aria-labelledby="myModalLabel">

            <div class="modal-dialog" role="document">
                <div class="modal-content">

                    <div class="modal-header">
                        <h4 class="modal-title" id="myModalLabel">新建任务</h4>
                        <button type="button" class="close" data-dismiss="modal"
                                aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>

                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal">

                            <div class="form-group">
                                <label class="col-sm-3 control-label">名称</label>
                                <div class="col-sm-9">
                                    <input type="text" name="taskName" class="form-control"
                                           id="taskName_add_input" placeholder="任务名称"> <span
                                        class="help-block"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">任务类型</label>
                                <div class="col-sm-9">
                                    <label class="radio-inline">
                                        <input type="radio"   name="taskType"    value="claim"  checked="checked"> 认领制
                                    </label> <label class="radio-inline">
                                    <input type="radio" name="taskType" value="coordination"> 协同制
                                </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">人员选择</label>
                                    <span class="help-block"></span>
                                <div class="col-sm-9">
                                <input type="text" name="taskSelectPeople"   class="form-control input-sm" id="selectPage" >
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">说明</label>
                                <div class="col-sm-9">
                                    <textarea class="form-control" name="taskDescription" rows="5"id="taskDescription_add_input"  placeholder="任务描述"></textarea>
                                     <span
                                        class="help-block"></span>
                                </div>
                                <input type="hidden" name="taskCharge" th:value="${session.loginUser.userRealname}" >
                            </div>

                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="task_save_btn">新建</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>

                    </div>
                </div>
            </div>
        </div>

        <!--认领任务模态框-->
        <div class="modal fade" id="taskClaimModal" tabindex="-1" role="dialog"
             aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title" id="myModalLabel1">认领任务</h4>
                        <button type="button" class="close" data-dismiss="modal"
                                aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal">
                            <div class="form-group">
                                <label class="col-sm-2 control-label">名称</label>
                                <div class="col-sm-10">
                                    <input type="text" name="taskName" class="form-control"
                                           id="taskName_claim" placeholder="任务名称"> <span
                                        class="help-block"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">任务类型</label>
                                <div class="col-sm-10">
                                    <label class="radio-inline">
                                        <input type="radio" name="taskType" value="claim"   checked="checked"> 认领制
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio"  name="taskType" value="coordination"> 协同制
                                    </label>
                                </div>

                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">负责人</label>
                                <div class="col-sm-10">
                                    <input type="text" name="taskCharge" class="form-control"
                                           id="taskSelectPeople_claim" readonly="readonly"> <span
                                        class="help-block"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">说明</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control" name="taskDescription" rows="5"id="taskDescription_claim"  placeholder="任务描述"></textarea>
                                    <span
                                            class="help-block"></span>
                                </div>
                                <input type="hidden" name="taskCharge" th:value="${session.loginUser.userName}" >
                                <input type="hidden" name="userId"  id="userId" th:value="${session.loginUser.userId}" >
                                <input type="hidden" name="taskId_claim"  id="taskId_claim"  >
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-primary" id="task_claim_save_btn">认领</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 信息查看模态框-->
        <div class="modal fade" id="taskInfoModal" tabindex="-1" role="dialog"
             aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title" id="myModalLabel2">任务查看</h4>
                        <button type="button" class="close" data-dismiss="modal"
                                aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>

                    </div>
                    <div class="modal-body">
                        <form class="form-horizontal">
                            <div class="form-group">
                                <label class="col-sm-2 control-label">名称</label>
                                <div class="col-sm-10">
                                    <input type="text" name="taskName" class="form-control"
                                           id="taskName_view" placeholder="任务名称"> <span
                                        class="help-block"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">任务类型</label>
                                <div class="col-sm-10">
                                    <label class="radio-inline">
                                        <input type="radio"  name="taskType"  value="claim"  > 认领制
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="taskType"  value="coordination" checked="checked"> 协同制
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">负责人</label>
                                <div class="col-sm-10">
                                    <input type="text" name="taskCharge" class="form-control"
                                           id="taskCharge_view" readonly="readonly"> <span
                                        class="help-block"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">说明</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control" name="taskDescription" rows="5"id="taskDescription_view"  placeholder="任务描述"></textarea>
                                    <span
                                            class="help-block"></span>
                                </div>
                                <input type="hidden" name="taskCharge" th:value="${session.loginUser.userName}" >
                                <input type="hidden" name="userId"  id="intfo_userId" th:value="${session.loginUser.userId}" >

                            </div>

                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>

                    </div>
                </div>
            </div>
        </div>



        <!--人员选择模态框-->
        <div class="modal fade" id="testModal" tabindex="-1" role="dialog"
             aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title" id="modal-title">测试框</h4>
                        <button type="button" class="close" data-dismiss="modal"
                                aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>

                    </div>
                    <div class="modal-body">
                    </div>
                </div>
            </div>
        </div>

            <div class="row">
            <div class="col-md-5 pl-1 pr-1">
                <div class="navbar-form navbar-left pl-2" role="search">
                    <div class="form-group">
                            时间检索:
                        <div class="input-group date col-xs-4" id="yyyy_mm_dd">
                            <input name="regDate" class="form-control input-sm" id="startTime" type="text" value="" readonly="readonly"> <span
                                class="input-group-addon" style="opacity: 0.8;"> <span
                                class="glyphicon glyphicon-remove"></span>
									</span>
                        </div>
                        至
                        <div class="input-group date col-xs-4" id="yyyy_mm_dd2">
                            <input name="regDate" class="form-control input-sm" id="endTime" type="text" value="" readonly="readonly"> <span
                                class="input-group-addon" style="opacity: 0.8;"> <span
                                class="glyphicon glyphicon-remove"></span>
									</span>
                        </div>
                        <button class="btn btn-primary btn-sm"  id="serachTaskByTime">查询</button>
                    </div>

                </div>
            </div>
            <div class="col-md-3 pl-1 pr-1">
                <div class="navbar-form navbar-left" role="search">
                    <div class="form-group">
                        <input type="text" class="form-control form-custom input-sm" id="searchKey" placeholder="任务名称检索">
                    </div>
                    <button class="btn btn-primary btn-sm" id="searchByName">搜索</button>
                </div>
            </div>
                <div class="col-md-2 pt-2 pl-1 pr-1">
                    <select class="form-control input-sm" id="fieldTask" name="fieldTask"  placeholder="过滤条件"> <option value="" disabled selected hidden>请选择要显示的任务</option><option value="1">全部任务</option><option value="2">待领任务</option><option value="3">进行中的</option><option value="4">办结任务</option></select>
                </div>
            <div class="col-md-1 pl-1 pr-1">
                <div class="navbar-form navbar-right" role="search">
                <div class="form-group">
                <button class="btn btn-success btn-sm" id="task_add_modal_btn">新建任务</button>
                </div>
                </div>
            </div>
        </div>
        <!-- 显示表格数据 -->
        <div class="row">
            <div class="col-md-12">
                <table class="table table-hover" id="task_table">
                    <thead>
                    <tr>
                        <th>序号</th>
                        <th>任务名称</th>
                        <th>类型</th>
                        <th>负责人</th>
                        <th>发布日期</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 显示分页信息 -->
        <div class="row">
            <!--分页文字信息  -->
            <div class="col-md-6" id="page_info_area"></div>
            <!-- 分页条信息 -->
            <div class="col-md-6" id="page_nav_area"></div>

        </div>
    </div>

</main>


<script src="/webjars/jquery/3.1.1/jquery.min.js"></script>
<script src="/webjars/bootstrap/3.3.7-1/js/bootstrap.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/bootstrap-datetimepicker.min.js"></script>
<script src="/js/bootstrap-datetimepicker.zh-CN.js"></script>
<script src="/js/bulid.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
<!-- 下拉分页插件核心脚本 -->
<script src="/js/selectpage.js"></script>


<script type="text/javascript">
    var totalRecord;
    var userId=$("#userId").val();
    var virtulNum = new Array();
    var tag_data;

    $(function () {
        to_page(1);
        getUsers(1);

    });


    function show_validate_msg(ele, status, msg) {
        //清除当前元素的校验状态
        $(ele).parent().removeClass("has-success has-error");
        $(ele).next("span").text("");
        if ("success" == status) {
            $(ele).parent().addClass("has-success");
            $(ele).next("span").text(msg);
        } else if ("error" == status) {
            $(ele).parent().addClass("has-error");
            $(ele).next("span").text(msg);
        }
    }
    $("#fieldTask").change(function(){
        var fieldType=$("#fieldTask").val();
        if(fieldType==1){
            //全部任务
            to_page(1);
        }
        if(fieldType==2){
            //待领任务
            to_claimPage(1);
            alert("待领任务！");

        }
        if(fieldType==3){
            //进行中的任务
        }
        if(fieldType==4){
            //办结任务
        }
    });

    //分页查询个人可领的任务
    function to_claimPage(pn){
        $.ajax({
            url: "/task/canClaim",
            data: "pageNum=" + pn+"&userId="+userId,
            type: "GET",
            success: function (result) {
                console.log(result);
                bulid_page_table(result);
                bulid_page_info(result);
                bulid_page_nav(result)
            }
         });
    }

    //分页查询全部任务请求
    function to_page(pn) {
        $.ajax({
            url: "/task/all",
            data: "pageNum=" + pn,
            type: "GET",
            success: function (result) {
                console.log(result);
                bulid_page_table(result);
                bulid_page_info(result);
                bulid_page_nav(result)
            }
        });
    }
    //分页页码
    function getVirtulNum(result) {
        var b = 1;
        for (var k = 0; k < result.extend.pageInfo.pages; k++) {
            virtulNum[k] = new Array();
            for (var j = 0; j < 5; j++) {
                virtulNum[k][j] = b;
                b++;
            }
        }
    }
    //构建表格
    function bulid_page_table(result) {
        $("#task_table tbody").empty();
        getVirtulNum(result);
        var users = result.extend.pageInfo.list;
        var numInfo=result.extend.pageInfo;
        var status=null;
        var i=null;
        console.log(virtulNum);
        $.each(users, function (index, item) {
            var taskId = $("<td></td>").append(virtulNum[numInfo.pageNum-1][i++]);
            var taskName = $("<td></td>").append(item.taskName);
            var taskType = $("<td></td>").append(item.taskType == 'claim' ? "认领制" : "协同制");

            var taskCharge = $("<td></td>").append(item.taskCharge);
            var formatTaskStartTime = $("<td></td>").append(item.formatTaskStartTime);
            var editBtn =null;
            if (item.taskStatus==1){
                status='进行中';
                editBtn = $("<button></button>")
                    .addClass(
                        "btn btn-primary btn-sm btn-info")
                    .append(
                        $("<span></span>")
                            .addClass(
                                "glyphicon glyphicon-pencil"))
                    .append("查看");
                //给编辑按钮添加属性，绑定任务id
                editBtn.attr("edit-id", item.taskId);
            } else if(item.taskStatus==2){
                status="办结";
                editBtn = $("<button></button>")
                    .addClass(
                        "btn btn-primary btn-sm  btn-success")
                    .append(
                        $("<span></span>")
                            .addClass(
                                "glyphicon glyphicon-pencil"))
                    .append("查看");
                //给编辑按钮添加属性，绑定任务id
                editBtn.attr("edit-id", item.taskId);
            }else if(item.taskStatus==3){
                status ="待领";
                editBtn = $("<button></button>")
                    .addClass(
                        "btn btn-primary btn-sm  edit_btn")
                    .append(
                        $("<span></span>")
                            .addClass(
                                "glyphicon glyphicon-pencil"))
                    .append("认领");
                //给编辑按钮添加属性，绑定任务id
                editBtn.attr("edit-id", item.taskId);
            }
            var taskStatus = $("<td></td>").append(status);
            var btnTd = $("<td></td>").append(editBtn);
            $("<tr></tr>").append(taskId).append(taskName).append(taskType).append(taskCharge)
                .append(formatTaskStartTime).append(taskStatus).append(btnTd).appendTo("#task_table tbody");
        });
    }
    //解析显示分页信息
    function bulid_page_info(result) {
        $("#page_info_area").empty();
        $("#page_info_area").append(
            "当前第" + result.extend.pageInfo.pageNum + "页,总"
            + result.extend.pageInfo.pages + "页,总"
            + result.extend.pageInfo.total + "条记录");
        totalRecord = result.extend.pageInfo.total;
        currentPage = result.extend.pageInfo.pageNum;
    }
    //构建翻页条
    function bulid_page_nav(result) {
        //page_nav_area
        $("#page_nav_area").empty();
        var ul = $("<ul></ul>").addClass("pagination");
        //构建元素
        var firstPageLi = $("<li></li>").append(
            $("<a></a>").append("首页").attr("href", "#"));
        var prePageLi = $("<li></li>").append(
            $("<a></a>").append("&laquo;"));
        if (result.extend.pageInfo.hasPreviousPage == false) {
            firstPageLi.addClass("disabled");
            prePageLi.addClass("disabled");
        } else {
            //为元素添加点击翻页的事件
            firstPageLi.click(function () {
                to_page(1);
            });
            prePageLi.click(function () {
                to_page(result.extend.pageInfo.pageNum - 1);
            });
        }
        var nextPageLi = $("<li></li>").append(
            $("<a></a>").append("&raquo;"));
        var lastPageLi = $("<li></li>").append(
            $("<a></a>").append("末页").attr("href", "#"));
        if (result.extend.pageInfo.hasNextPage == false) {
            nextPageLi.addClass("disabled");
            lastPageLi.addClass("disabled");
        } else {
            nextPageLi.click(function () {

                to_page(result.extend.pageInfo.pageNum + 1);
            });
            lastPageLi.click(function () {
                to_page(result.extend.pageInfo.pages);
            });
        }

        //添加首页和前一页 的提示
        ul.append(firstPageLi).append(prePageLi);
        //1,2，3遍历给ul中添加页码提示
        $.each(result.extend.pageInfo.navigatepageNums, function (index,
                                                                  item) {

            var numLi = $("<li></li>").append($("<a></a>").append(item));
            if (result.extend.pageInfo.pageNum == item) {
                numLi.addClass("active");
            }
            numLi.click(function () {
                to_page(item);
            });
            ul.append(numLi);
        });
        //添加下一页和末页 的提示
        ul.append(nextPageLi).append(lastPageLi);

        //把ul加入到nav
        var navEle = $("<nav></nav>").append(ul);
        navEle.appendTo("#page_nav_area");

    }

    //获取用户
    function getUsers(pn){
        $.ajax({
            url:"/user/alls",
            type:"GET",
            async: false,
            success:function (result) {

                tag_data=result.extend.pageInfo;

                initSelecPage();
            }
        });
    }
    //初始化下拉插件
    function initSelecPage(){
        //初始化插件
        $('#selectPage').selectPage(
            {
                showField : 'userRealname',
                keyField : 'userId',
                data :tag_data,
                multiple : true
            });
    }

    //发送认领请求
    $("#task_claim_save_btn")
        .click(function(){
            $.ajax({
                url: "/task/claim",
                type: "GET",
                data: "taskId=" + $("#taskId_claim").val()+"&userId="+$("#userId").val()+"&taskType="+$("#taskClaimModal input[name=taskType]").val(),
                success: function (result) {
                    if (result.code == 100) {
                        alert(result.msg);
                        //员工保存成功；
                        //1、关闭模态框
                        $("#taskClaimModal").modal('hide');
                    }
                    else if(result.code==200){
                        console.log(result)
                        alert(result.extend.errorInfo);
                    }
                }
            });
        });

    //按任务名称搜索请求
    $("#searchByName").click(function(){
        var  pn=1;
        $.ajax({
            url:"/task/searchByName?searchKey="+$("#searchKey").val()+"&pageNum=" + pn,
            type:"GET",
            success:function(result){
                $("#page_info_area").empty();
                $("#page_nav_area").empty();
                $("#task_table tbody").empty();
                bulid_page_table(result);
                bulid_page_info(result);
                bulid_page_nav(result)
            }
        });
    });

    //根据taskId 获取任务请求
    function getTask(taskId) {
        $.ajax({
            url : "/task/getById?taskId=" + taskId,
            type : "GET",
            success : function(result) {
                console.log(result);
                var taskDate = result.extend.task;
                $("#taskName_claim").val(taskDate.taskName);
                $("#taskClaimModal input[name=taskType]").val([taskDate.taskType]);
                $("#taskId_claim").val(taskDate.taskId);
                $("#taskDescription_claim").val(taskDate.taskDescription);

                $("#taskName_view").val(taskDate.taskName);
                $("#taskInfoModal input[name=taskType]").val([taskDate.taskType]);
                $("#taskCharge_view").val(taskDate.taskCharge);
                $("#taskId_view").val(taskDate.taskId);
                $("#taskDescription_view").val(taskDate.taskDescription);

            }
        });
    }

    //发送新建任务信息
    $("#task_save_btn") .click( function() {
                //var userIds=$("#selectPage").val();
                $.ajax({
                    url : "/task/save",
                    type : "POST",
                    data : $("#taskAddModal form")
                        .serialize(),
                    success : function(result) {
                        if (result.code == 100) {
                            alert(result.msg);
                            //员工保存成功；
                            //1、关闭模态框
                            $("#taskAddModal").modal('hide');

                            //2、来到最后一页，显示刚才保存的数据
                            //发送ajax请求显示最后一页数据即可
                            to_page(totalRecord);
                        }
                    }
                });
            });



    //新建任务模态框
    $("#task_add_modal_btn").click(function() {
        reset_form("#taskAddModal form");
        $("#taskAddModal").modal({
            backdrop : "static"
        });
    });

    //认领模态框
    $(document).on("click", ".edit_btn", function() {
        getTask($(this).attr("edit-id"))
        // $("#task_edit_btn").attr("edit_id",$(this).attr("edit-id"));
        $("#taskClaimModal").modal({
            backdrop : "static"
        });
    });

    //查看信息模态框
    $(document).on("click", ".btn-info", function() {
        getTask($(this).attr("edit-id"))

        $("#taskInfoModal").modal({
            backdrop : "static"
        });
    });

    //日期事件
    $('#yyyy_mm_dd').datetimepicker(
        {
            bootcssVer: 3,
            format: "yyyy-mm-dd",
            //endDate: 2017,
            autoclose: true,
            startView: 4,
            minView: 2,
            maxView: 4,
            language: 'zh-CN',
            todayBtn: 1,
            todayHighlight: 1
        });

    $('#yyyy_mm_dd2').datetimepicker({
        bootcssVer: 3,
        format: "yyyy-mm-dd",
        //endDate: 2017,
        autoclose: true,
        startView: 4,
        minView: 2,
        maxView: 4,
        language: 'zh-CN',
        todayBtn: 1,
        todayHighlight: 1
    });

    $("#serachTaskByTime").click(function(){
            console.log($("#startTime").val()+"-"+$("#endTime").val());
            var startTime=$("#startTime").val();
            var endTime=$("#endTime").val();

            $.ajax({
                url : "/task/serachTaskByTime",
                data : "taskStartTime=" + startTime+"&taskEndTime="+endTime,
                type : "POST",
                success : function(result) {
                    if (result.code == 100) {
                        bulid_page_table(result);
                    } else {
                        alert("查询失败！")
                    }
                }
            });


    });

    //校验用户名是否可用
    $("#taskName_add_input").change(
        function() {
            //发送ajax请求校验任务名是否可用
            var taskName = this.value;
            $.ajax({
                url : "/task/checkTask",
                data : "taskName=" + taskName,
                type : "POST",
                success : function(result) {
                    if (result.code == 100) {
                        show_validate_msg("#taskName_add_input",
                            "success", "用户名可用");
                        $("#task_save_btn").attr("ajax-va", "success"); //数据校验成功则允许保存
                    } else {
                        show_validate_msg("#taskName_add_input",
                            "error", result.extend.val_msg);
                        $("#task_save_btn").attr("ajax-va", "error");
                    }
                }
            });
        });
</script>

</body>
</html>